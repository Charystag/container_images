# syntax=docker/dockerfile:1

FROM debian:latest

RUN apt -y update && \
    apt -y upgrade && \
    apt -y install \
        curl \
        git \
        less \
        man \
        neovim \
        python3 \
        tmux \
        zsh

RUN sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"

RUN yes | unminimize

WORKDIR /app

COPY ./scripts/zsh-plugins.sed plugins

RUN  sed -i -f plugins $HOME/.zshrc

RUN rm plugins

RUN chsh -s "$(which zsh)"

CMD ["zsh"]

RUN ln -s -T /usr/bin/python3.12 /usr/bin/python

ARG architecture=arm #architecture can either be "arm", "x86_64" or "x86"
#run: docker build --build-arg architecture=[your_architecture] -t [your_tag] -f gcloud_cli .

WORKDIR /install

RUN curl -O "https://dl.google.com/dl/cloudsdk/channels/rapid/downloads/google-cloud-cli-linux-${architecture}.tar.gz"

RUN tar -xvf "google-cloud-cli-linux-${architecture}.tar.gz"

WORKDIR ./google-cloud-sdk

RUN ./install.sh --usage-reporting false --path-update true --rc-path /root/.zshrc -q

RUN rm "../google-cloud-cli-linux-${architecture}.tar.gz"

WORKDIR /app

COPY ./aliases/gcloud.zsh .

RUN cat gcloud.zsh >> "$HOME/.zshrc"

RUN rm gcloud.zsh
